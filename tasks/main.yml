---

# ----- set drbd device -----

- name: parted drbd disk
  parted:
    device: "{{ ha_drbd_disk }}"
    number: 1
    state: present

- name: Create drbd-vg1
  lvg:
    vg: drbdpool
    pvs: "{{ ha_drbd_disk }}1"

# ----- set drbd9 -----

- name: import RPM-GPG-KEY-elrepo
  rpm_key:
    state: present
    key: https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
  tags: drbd9

- name: install elrepo repository
  yum:
    name: http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
  tags: drbd9

- name: install drbd9
  yum:
    name:
      - kmod-drbd90
      - drbd90-utils
    state: present
  tags: drbd9

- name: deploy drbd1.res
  template:
    src: "drbd1.res.j2"
    dest: "/etc/drbd.d/drbd1.res"
    owner: "root"
    group: "root"
    mode: 0644    

- name: deploy global_common.conf
  copy:
    src: "global_common.conf"
    dest: "/etc/drbd.d/global_common.conf"
    owner: "root"
    group: "root"
    mode: 0644

- name: 


# ----- set keepalived -----

- name: install keepalived
  yum:
    name: keepalived
    state: present
  tags: keepalived
